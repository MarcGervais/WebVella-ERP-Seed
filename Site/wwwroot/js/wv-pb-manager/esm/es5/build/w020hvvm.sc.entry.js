import{h}from"../wv-pb-manager.core.js";import{a as setDrake,b as addDrakeContainerId,c as setActiveNode,d as hoverNode,e as hoverContainer,f as setNodeCreation,g as addNode,h as removeNode,i as setOptionsModalState,j as setHelpModalState,k as addReloadNodeIds,l as removeReloadNodeIds,m as updateNodeOptions,n as updatePageNodes,o as _,p as SET_DRAKE,q as ADD_DRAKE_CONTAINER_ID,r as SET_ACTIVE_NODE,s as SET_NODE_CREATION,t as HOVER_NODE,u as HOVER_CONTAINER,v as ADD_NODE,w as UPDATE_NODE_OPTIONS,x as UPDATE_PAGE_NODES,y as REMOVE_NODE,z as SET_OPTIONS_MODAL_STATE,A as SET_HELP_MODAL_STATE,B as ADD_RELOAD_NODE_IDS,C as REMOVE_RELOAD_NODE_IDS,D as commonjsGlobal}from"./chunk-67aaa8e8.js";var bind=function(e,t){return function(){for(var n=new Array(arguments.length),o=0;o<n.length;o++)n[o]=arguments[o];return e.apply(t,n)}},isBuffer_1=function(e){return null!=e&&(isBuffer(e)||isSlowBuffer(e)||!!e._isBuffer)};function isBuffer(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function isSlowBuffer(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&isBuffer(e.slice(0,0))}var toString=Object.prototype.toString;function isArray(e){return"[object Array]"===toString.call(e)}function isArrayBuffer(e){return"[object ArrayBuffer]"===toString.call(e)}function isFormData(e){return"undefined"!=typeof FormData&&e instanceof FormData}function isArrayBufferView(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer}function isString(e){return"string"==typeof e}function isNumber(e){return"number"==typeof e}function isUndefined(e){return void 0===e}function isObject(e){return null!==e&&"object"==typeof e}function isDate(e){return"[object Date]"===toString.call(e)}function isFile(e){return"[object File]"===toString.call(e)}function isBlob(e){return"[object Blob]"===toString.call(e)}function isFunction(e){return"[object Function]"===toString.call(e)}function isStream(e){return isObject(e)&&isFunction(e.pipe)}function isURLSearchParams(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams}function trim(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}function isStandardBrowserEnv(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document}function forEach(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),isArray(e))for(var n=0,o=e.length;n<o;n++)t.call(null,e[n],n,e);else for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.call(null,e[r],r,e)}function merge(){var e={};function t(t,n){e[n]="object"==typeof e[n]&&"object"==typeof t?merge(e[n],t):t}for(var n=0,o=arguments.length;n<o;n++)forEach(arguments[n],t);return e}function extend(e,t,n){return forEach(t,function(t,o){e[o]=n&&"function"==typeof t?bind(t,n):t}),e}var utils={isArray:isArray,isArrayBuffer:isArrayBuffer,isBuffer:isBuffer_1,isFormData:isFormData,isArrayBufferView:isArrayBufferView,isString:isString,isNumber:isNumber,isObject:isObject,isUndefined:isUndefined,isDate:isDate,isFile:isFile,isBlob:isBlob,isFunction:isFunction,isStream:isStream,isURLSearchParams:isURLSearchParams,isStandardBrowserEnv:isStandardBrowserEnv,forEach:forEach,merge:merge,extend:extend,trim:trim},global$1="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}var cachedSetTimeout=defaultSetTimout,cachedClearTimeout=defaultClearTimeout;function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch(t){try{return cachedSetTimeout.call(null,e,0)}catch(t){return cachedSetTimeout.call(this,e,0)}}}function runClearTimeout(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{return cachedClearTimeout(e)}catch(t){try{return cachedClearTimeout.call(null,e)}catch(t){return cachedClearTimeout.call(this,e)}}}"function"==typeof global$1.setTimeout&&(cachedSetTimeout=setTimeout),"function"==typeof global$1.clearTimeout&&(cachedClearTimeout=clearTimeout);var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(e)}}function nextTick(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];queue.push(new Item(e,t)),1!==queue.length||draining||runTimeout(drainQueue)}function Item(e,t){this.fun=e,this.array=t}Item.prototype.run=function(){this.fun.apply(null,this.array)};var title="browser",platform="browser",browser=!0,env={},argv=[],version="",versions={},release={},config={};function noop(){}var on=noop,addListener=noop,once=noop,off=noop,removeListener=noop,removeAllListeners=noop,emit=noop;function binding(e){throw new Error("process.binding is not supported")}function cwd(){return"/"}function chdir(e){throw new Error("process.chdir is not supported")}function umask(){return 0}var performance=global$1.performance||{},performanceNow=performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return(new Date).getTime()};function hrtime(e){var t=.001*performanceNow.call(performance),n=Math.floor(t),o=Math.floor(t%1*1e9);return e&&(n-=e[0],(o-=e[1])<0&&(n--,o+=1e9)),[n,o]}var startTime=new Date;function uptime(){return(new Date-startTime)/1e3}var process={nextTick:nextTick,title:title,browser:browser,env:env,argv:argv,version:version,versions:versions,on:on,addListener:addListener,once:once,off:off,removeListener:removeListener,removeAllListeners:removeAllListeners,emit:emit,binding:binding,cwd:cwd,chdir:chdir,umask:umask,hrtime:hrtime,platform:platform,release:release,config:config,uptime:uptime},normalizeHeaderName=function(e,t){utils.forEach(e,function(n,o){o!==t&&o.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[o])})},enhanceError=function(e,t,n,o,r){return e.config=t,n&&(e.code=n),e.request=o,e.response=r,e},createError=function(e,t,n,o,r){var a=new Error(e);return enhanceError(a,t,n,o,r)},settle=function(e,t,n){var o=n.config.validateStatus;n.status&&o&&!o(n.status)?t(createError("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)};function encode(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var buildURL=function(e,t,n){if(!t)return e;var o;if(n)o=n(t);else if(utils.isURLSearchParams(t))o=t.toString();else{var r=[];utils.forEach(t,function(e,t){null!=e&&(utils.isArray(e)?t+="[]":e=[e],utils.forEach(e,function(e){utils.isDate(e)?e=e.toISOString():utils.isObject(e)&&(e=JSON.stringify(e)),r.push(encode(t)+"="+encode(e))}))}),o=r.join("&")}return o&&(e+=(-1===e.indexOf("?")?"?":"&")+o),e},ignoreDuplicateOf=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],parseHeaders=function(e){var t,n,o,r={};return e?(utils.forEach(e.split("\n"),function(e){if(o=e.indexOf(":"),t=utils.trim(e.substr(0,o)).toLowerCase(),n=utils.trim(e.substr(o+1)),t){if(r[t]&&ignoreDuplicateOf.indexOf(t)>=0)return;r[t]="set-cookie"===t?(r[t]?r[t]:[]).concat([n]):r[t]?r[t]+", "+n:n}}),r):r},isURLSameOrigin=utils.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function o(e){var o=e;return t&&(n.setAttribute("href",o),o=n.href),n.setAttribute("href",o),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=o(window.location.href),function(t){var n=utils.isString(t)?o(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0},chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function E(){this.message="String contains an invalid character"}function btoa(e){for(var t,n,o=String(e),r="",a=0,i=chars;o.charAt(0|a)||(i="=",a%1);r+=i.charAt(63&t>>8-a%1*8)){if((n=o.charCodeAt(a+=.75))>255)throw new E;t=t<<8|n}return r}E.prototype=new Error,E.prototype.code=5,E.prototype.name="InvalidCharacterError";var btoa_1=btoa,cookies=utils.isStandardBrowserEnv()?{write:function(e,t,n,o,r,a){var i=[];i.push(e+"="+encodeURIComponent(t)),utils.isNumber(n)&&i.push("expires="+new Date(n).toGMTString()),utils.isString(o)&&i.push("path="+o),utils.isString(r)&&i.push("domain="+r),!0===a&&i.push("secure"),document.cookie=i.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},btoa$1="undefined"!=typeof window&&window.btoa&&window.btoa.bind(window)||btoa_1,xhr=function(e){return new Promise(function(t,n){var o=e.data,r=e.headers;utils.isFormData(o)&&delete r["Content-Type"];var a=new XMLHttpRequest,i="onreadystatechange",s=!1;if("test"===process.env.NODE_ENV||"undefined"==typeof window||!window.XDomainRequest||"withCredentials"in a||isURLSameOrigin(e.url)||(a=new window.XDomainRequest,i="onload",s=!0,a.onprogress=function(){},a.ontimeout=function(){}),e.auth&&(r.Authorization="Basic "+btoa$1((e.auth.username||"")+":"+(e.auth.password||""))),a.open(e.method.toUpperCase(),buildURL(e.url,e.params,e.paramsSerializer),!0),a.timeout=e.timeout,a[i]=function(){if(a&&(4===a.readyState||s)&&(0!==a.status||a.responseURL&&0===a.responseURL.indexOf("file:"))){var o="getAllResponseHeaders"in a?parseHeaders(a.getAllResponseHeaders()):null;settle(t,n,{data:e.responseType&&"text"!==e.responseType?a.response:a.responseText,status:1223===a.status?204:a.status,statusText:1223===a.status?"No Content":a.statusText,headers:o,config:e,request:a}),a=null}},a.onerror=function(){n(createError("Network Error",e,null,a)),a=null},a.ontimeout=function(){n(createError("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",a)),a=null},utils.isStandardBrowserEnv()){var d=cookies,c=(e.withCredentials||isURLSameOrigin(e.url))&&e.xsrfCookieName?d.read(e.xsrfCookieName):void 0;c&&(r[e.xsrfHeaderName]=c)}if("setRequestHeader"in a&&utils.forEach(r,function(e,t){void 0===o&&"content-type"===t.toLowerCase()?delete r[t]:a.setRequestHeader(t,e)}),e.withCredentials&&(a.withCredentials=!0),e.responseType)try{a.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&a.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&a.upload&&a.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then(function(e){a&&(a.abort(),n(e),a=null)}),void 0===o&&(o=null),a.send(o)})},DEFAULT_CONTENT_TYPE={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset(e,t){!utils.isUndefined(e)&&utils.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}function getDefaultAdapter(){var e;return"undefined"!=typeof XMLHttpRequest?e=xhr:void 0!==process&&(e=xhr),e}var defaults={adapter:getDefaultAdapter(),transformRequest:[function(e,t){return normalizeHeaderName(t,"Content-Type"),utils.isFormData(e)||utils.isArrayBuffer(e)||utils.isBuffer(e)||utils.isStream(e)||utils.isFile(e)||utils.isBlob(e)?e:utils.isArrayBufferView(e)?e.buffer:utils.isURLSearchParams(e)?(setContentTypeIfUnset(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):utils.isObject(e)?(setContentTypeIfUnset(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};utils.forEach(["delete","get","head"],function(e){defaults.headers[e]={}}),utils.forEach(["post","put","patch"],function(e){defaults.headers[e]=utils.merge(DEFAULT_CONTENT_TYPE)});var defaults_1=defaults;function InterceptorManager(){this.handlers=[]}InterceptorManager.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},InterceptorManager.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},InterceptorManager.prototype.forEach=function(e){utils.forEach(this.handlers,function(t){null!==t&&e(t)})};var InterceptorManager_1=InterceptorManager,transformData=function(e,t,n){return utils.forEach(n,function(n){e=n(e,t)}),e},isCancel=function(e){return!(!e||!e.__CANCEL__)},isAbsoluteURL=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)},combineURLs=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e};function throwIfCancellationRequested(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var dispatchRequest=function(e){return throwIfCancellationRequested(e),e.baseURL&&!isAbsoluteURL(e.url)&&(e.url=combineURLs(e.baseURL,e.url)),e.headers=e.headers||{},e.data=transformData(e.data,e.headers,e.transformRequest),e.headers=utils.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),utils.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||defaults_1.adapter)(e).then(function(t){return throwIfCancellationRequested(e),t.data=transformData(t.data,t.headers,e.transformResponse),t},function(t){return isCancel(t)||(throwIfCancellationRequested(e),t&&t.response&&(t.response.data=transformData(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})};function Axios(e){this.defaults=e,this.interceptors={request:new InterceptorManager_1,response:new InterceptorManager_1}}Axios.prototype.request=function(e){"string"==typeof e&&(e=utils.merge({url:arguments[0]},arguments[1])),(e=utils.merge(defaults_1,{method:"get"},this.defaults,e)).method=e.method.toLowerCase();var t=[dispatchRequest,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)n=n.then(t.shift(),t.shift());return n},utils.forEach(["delete","get","head","options"],function(e){Axios.prototype[e]=function(t,n){return this.request(utils.merge(n||{},{method:e,url:t}))}}),utils.forEach(["post","put","patch"],function(e){Axios.prototype[e]=function(t,n,o){return this.request(utils.merge(o||{},{method:e,url:t,data:n}))}});var Axios_1=Axios;function Cancel(e){this.message=e}Cancel.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},Cancel.prototype.__CANCEL__=!0;var Cancel_1=Cancel;function CancelToken(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(e){t=e});var n=this;e(function(e){n.reason||(n.reason=new Cancel_1(e),t(n.reason))})}CancelToken.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},CancelToken.source=function(){var e;return{token:new CancelToken(function(t){e=t}),cancel:e}};var CancelToken_1=CancelToken,spread=function(e){return function(t){return e.apply(null,t)}};function createInstance(e){var t=new Axios_1(e),n=bind(Axios_1.prototype.request,t);return utils.extend(n,Axios_1.prototype,t),utils.extend(n,t),n}var axios=createInstance(defaults_1);axios.Axios=Axios_1,axios.create=function(e){return createInstance(utils.merge(defaults_1,e))},axios.Cancel=Cancel_1,axios.CancelToken=CancelToken_1,axios.isCancel=isCancel,axios.all=function(e){return Promise.all(e)},axios.spread=spread;var axios_1=axios,default_1=axios;axios_1.default=default_1;var axios$1=axios_1,WvPbEventPayload=function(){this.node=null,this.component_name=null,this.original_event=null};function AddNewComponent(e,t){var n=e.store.getState().createdNode;n.component_name=t.name,n.options=JSON.stringify(n.options);var o=e.store.getState().siteRootUrl+"/api/v3.0/page/"+n.page_id+"/node/create",r=e.store.getState().recordId;r&&(o+="?recId="+r),axios$1.post(o,n,{headers:{"Content-Type":"application/json;charset=UTF-8","Access-Control-Allow-Origin":"*"}}).then(function(t){e.addNode(t.data),window.setTimeout(function(){e.addReloadNodeIds(t.data.id);var o=new Event("WvPbManager_Node_Added"),r=new WvPbEventPayload;r.original_event=event,r.node=n,r.component_name=n.component_name,o.payload=r,document.dispatchEvent(o)},10)}).catch(function(e){e.response?e.response.data?alert(e.response.data):alert(e.response.statusText):e.message?alert(e.message):alert(e)})}function RecalculateComponentList(e){var t=e.store.getState().library,n=[];switch((n=e.filterString?_.filter(t,function(t){var n=t.label.toLowerCase().includes(e.filterString.toLowerCase());return n||(n=t.library.toLowerCase().includes(e.filterString.toLowerCase())),n||(n=t.description.toLowerCase().includes(e.filterString.toLowerCase())),n}):t)||(n=[]),e.sort){case"usage":n=_.orderBy(n,["usage_counter"],["desc"]);break;case"alpha":n=_.orderBy(n,["label"],["asc"]);break;default:n=_.orderBy(n,["last_used_on"],["desc"])}var o=(e.page-1)*e.pageSize,r=o+e.pageSize,a=n.length;r>a&&(r=a),e.total=a,e.pageCount=e.total/e.pageSize,e.componentList=_.slice(n,o,r)}var WvCreateModal=function(){function e(){this.isCreateModalVisible=!1,this.page=1,this.pageSize=24,this.sort="recent",this.componentList=new Array,this.total=0,this.pageCount=0,this.focused=!1}return e.prototype.componentWillLoad=function(){this.store.mapStateToProps(this,function(e){return{isCreateModalVisible:e.isCreateModalVisible}}),this.store.mapDispatchToProps(this,{setNodeCreation:setNodeCreation,addNode:addNode,addReloadNodeIds:addReloadNodeIds}),document.body.className=document.body.className.replace(" modal-open","").replace("modal-open",""),document.body.style.paddingRight=null;var e=document.getElementById("wv-pb-backdrop");e&&e.parentNode.removeChild(e),RecalculateComponentList(this)},e.prototype.cancelNodeCreateHandler=function(e){e.preventDefault(),e.stopPropagation(),this.filterString="",RecalculateComponentList(this),this.setNodeCreation(null)},e.prototype.filterChangeHandler=function(e){e.preventDefault(),e.stopPropagation(),this.filterString=e.target.value,this.page=1,RecalculateComponentList(this)},e.prototype.selectComponent=function(e,t){e.preventDefault(),e.stopPropagation(),AddNewComponent(this,t),this.filterString="",RecalculateComponentList(this)},e.prototype.changeSort=function(e,t){e.preventDefault(),this.sort=t,this.page=1,RecalculateComponentList(this)},e.prototype.changePage=function(e,t){e.preventDefault(),t>0&&(this.page=t),RecalculateComponentList(this)},e.prototype.render=function(){var e=this;if(!e.isCreateModalVisible)return e.focused=!1,e.filterString="",this.page=1,this.sort="recent",null;e.focused||window.setTimeout(function(){var t=document.getElementById("wv-pb-select-component-input");t&&(t.focus(),e.focused=!0)},10);for(var t=[0,1,2,3],n=[],o=1;o<e.pageCount+1;o++)n.push(o);return h("div",{class:"modal show d-block",style:{paddingRight:"17px"}},h("div",{class:"modal-dialog modal-full"},h("div",{class:"modal-content"},h("div",{class:"modal-header d-none"},h("h5",{class:"modal-title"},"Select component"),h("button",{type:"button",class:"close",onClick:function(t){return e.cancelNodeCreateHandler(t)}},h("span",{"aria-hidden":"true"},"×"))),h("div",{class:"modal-body"},h("nav",{class:"navbar navbar-expand-lg navbar-light mb-3 go-bkg-blue-gray-light"},h("div",{class:"flex-grow-1"},h("ul",{class:"nav nav-pills"},h("li",{class:"nav-item"},h("a",{class:"nav-link "+("recent"===e.sort?"active":""),href:"#",onClick:function(t){return e.changeSort(t,"recent")}},"Recent")),h("li",{class:"nav-item"},h("a",{class:"nav-link "+("usage"===e.sort?"active":""),href:"#",onClick:function(t){return e.changeSort(t,"usage")}},"Most Used")),h("li",{class:"nav-item"},h("a",{class:"nav-link "+("alpha"===e.sort?"active":""),href:"#",onClick:function(t){return e.changeSort(t,"alpha")}},"Alphabetical")))),h("div",{class:"form-inline"},h("input",{class:"form-control form-control-sm",placeholder:"component name",onInput:function(t){return e.filterChangeHandler(t)},id:"wv-pb-select-component-input"}))),e.componentList.map(function(n,o){return n=n,h("div",{class:"row"},t.map(function(t){var n=o+t;if(n<e.componentList.length&&o%4==0){var r=e.componentList[n],a="ti-file";return r.icon_class&&(a=r.icon_class),h("div",{class:"col-6 col-lg-3",key:r.name},h("div",{class:"shadow-sm mb-4 card icon-card clickable",onClick:function(t){return e.selectComponent(t,r)}},h("div",{class:"card-body p-1"},h("div",{class:"icon-card-body"},h("i",{class:"icon "+a}),h("div",{class:"meta"},h("div",{class:"title"},r.label),h("div",{class:"description"},r.description),h("div",{class:"library"},r.library))))))}}))}),h("nav",{"aria-label":"Page navigation example"},h("ul",{class:"pagination justify-content-center"},h("li",{class:"page-item "+(e.page>1?"":"disabled")},h("a",{class:"page-link",href:"#",onClick:function(t){return e.changePage(t,e.page-1)}},"Previous")),n.map(function(t){return h("li",{class:"page-item "+(e.page===t?"active":"")},h("a",{class:"page-link",href:"#",onClick:function(n){return e.changePage(n,t)}},t))}),h("li",{class:"page-item "+(e.page>=e.pageCount?"disabled":"")},h("a",{class:"page-link",href:"#",onClick:function(t){return e.changePage(t,e.page+1)}},"Next"))))),h("div",{class:"modal-footer"},h("button",{type:"button",class:"btn btn-white btn-sm",onClick:function(t){return e.cancelNodeCreateHandler(t)}},"Cancel")))))},Object.defineProperty(e,"is",{get:function(){return"wv-create-modal"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{componentList:{state:!0},filterString:{state:!0},isCreateModalVisible:{state:!0},page:{state:!0},pageCount:{state:!0},pageSize:{state:!0},sort:{state:!0},store:{context:"store"},total:{state:!0}}},enumerable:!0,configurable:!0}),e}(),WvCreateModal$1=function(){function e(){this.isHelpModalVisible=!1}return e.prototype.componentWillLoad=function(){this.store.mapStateToProps(this,function(e){return{isHelpModalVisible:e.isHelpModalVisible}}),this.store.mapDispatchToProps(this,{setHelpModalState:setHelpModalState})},e.prototype.cancelHelpModalHandler=function(e){e.preventDefault(),e.stopPropagation(),this.setHelpModalState(!1)},e.prototype.render=function(){var e=this;return e.isHelpModalVisible?h("div",{class:"modal show d-block",style:{paddingRight:"17px"},id:"modal-component-help"},h("div",{class:"modal-dialog modal-xl"},h("div",{class:"modal-content"},h("div",{class:"modal-header"},h("span",{class:"title"},"Component help"),h("span",{class:"aside"},"wv-",e.store.getState().activeNodeId)),h("div",{class:"modal-body",id:"modal-component-help-body"},h("wv-show-help",{nodeId:e.store.getState().activeNodeId})),h("div",{class:"modal-footer"},h("button",{type:"button",class:"btn btn-white btn-sm",onClick:function(t){return e.cancelHelpModalHandler(t)}},"Close"))))):null},Object.defineProperty(e,"is",{get:function(){return"wv-help-modal"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{isHelpModalVisible:{state:!0},store:{context:"store"}}},enumerable:!0,configurable:!0}),e}(),WvLoadingPane=function(){function e(){}return e.prototype.render=function(){return h("div",{class:"p-2"},h("i",{class:"fa fa-spin fa-spinner go-blue"})," Loading...")},Object.defineProperty(e,"is",{get:function(){return"wv-loading-pane"},enumerable:!0,configurable:!0}),e}();function seq(e,t,n){void 0===n&&(n=0),e[n]&&e[n](function(){++n===e.length?t():seq(e,t,n)})}function scriptsDone(){var e=document.createEvent("Event");e.initEvent("DOMContentLoaded",!0,!0),document.dispatchEvent(e)}function insertScript(e,t){var n=document.createElement("script");n.type="text/javascript",e.src?(n.onload=t,n.onerror=t,n.src=e.src):n.textContent=e.innerText,n.src.includes("http://localhost:3333/")&&(n.src=n.src.replace("http://localhost:3333/","http://localhost:2202/")),document.head.appendChild(n),e.parentNode.removeChild(e),e.src||t()}var runScriptTypes=["application/javascript","application/ecmascript","application/x-ecmascript","application/x-javascript","text/ecmascript","text/javascript","text/javascript1.0","text/javascript1.1","text/javascript1.2","text/javascript1.3","text/javascript1.4","text/javascript1.5","text/jscript","text/livescript","text/x-ecmascript","text/x-javascript"];function runScripts(e){var t,n=e.querySelectorAll("script"),o=[];[].forEach.call(n,function(e){(t=e.getAttribute("type"))&&-1===runScriptTypes.indexOf(t)||o.push(function(t){insertScript(e,t)})}),seq(o,scriptsDone,0)}function LoadNodeDesignHtmlFromServerToStack(e,t,n){"object"!=typeof e.options&&(e.options=e.options?JSON.parse(e.options):{});var o=n.store.getState().siteRootUrl+t.meta.design_view_url+"&nid="+e.id+"&pid="+e.page_id,r=n.store.getState().recordId;r&&(o+="&recId="+r),axios$1.post(o,e.options,{headers:{"Content-Type":"application/json;charset=UTF-8","Access-Control-Allow-Origin":"*"}}).then(function(o){var r=document.getElementById("node-design-"+e.id),a=new Array,i=r.querySelectorAll("[data-node-id]");_.forEach(i,function(e){a.push(e.getAttribute("data-node-id"))}),_.forEach(a,function(e){NodeUtils.MoveNodeToStack(e)}),r.remove();var s=document.createElement("div");s.id="node-design-"+e.id,s.classList.add("wv-pb-node"),s.innerHTML=o.data,document.getElementById("wv-node-design-stack").appendChild(s),runScripts(s),n.updateNodeOptions(e),window.setTimeout(function(){a.push(e.id),n.addReloadNodeIds(a);var o=new Event("WvPbManager_Design_Loaded"),r=new WvPbEventPayload;r.node=e,r.component_name=t.node.component_name,o.payload=r,document.dispatchEvent(o)},10)}).catch(function(e){e.response?e.response.data?console.log(e.response.data):console.log(e.response.statusText):e.message?console.log(e.message):console.log(e)})}var NodeUtils=function(){function e(){}return e.MoveNodeToStack=function(e){if(!e)return console.error("node id not defined MoveNodeToStack "+e),!1;var t=document.getElementById("node-design-"+e),n=document.getElementById("wv-node-design-stack");return t&&t.parentElement.id==="wv-node-"+e&&n?(n.appendChild(t),!0):(n?console.error("error to-stack "+e):console.error("stack is missing "),!1)},e.GetNodeFromStack=function(e){if(!e)return console.error("node id not defined GetNodeFromStack "+e),!1;var t=document.getElementById("node-design-"+e),n=document.getElementById("wv-node-"+e);return t&&"wv-node-design-stack"===t.parentElement.id&&n?(n.appendChild(t),!0):!(!t||t.parentElement.id!=="wv-node-"+e)||!n},e.GetNodeFromServerToStack=function(e,t,n){LoadNodeDesignHtmlFromServerToStack(e,t,n)},e.GetNodeAndMeta=function(e,t){var n={node:null,meta:null},o=e.store.getState().pageNodes,r=e.store.getState().library;if(t){var a=_.findIndex(o,function(e){return e.id==t});if(-1==a)return void console.error("Node with id "+t+" not found in pageNodes");n.node=Object.assign({},o[a]);var i=_.findIndex(r,function(e){return e.name==n.node.component_name});if(-1==i)return void console.error("Component name "+n.node.component_name+" not found in library");n.meta=r[i]}return n},e.GetActiveNodeAndMeta=function(e){var t={node:null,meta:null},n=e.store.getState().pageNodes,o=e.store.getState().library,r=e.store.getState().activeNodeId;if(r){var a=_.findIndex(n,function(e){return e.id==r});if(-1==a)return void console.error("Node with id "+r+" not found in pageNodes");t.node=Object.assign({},n[a]);var i=_.findIndex(o,function(e){return e.name==t.node.component_name});if(-1==i)return void console.error("Component name "+t.node.component_name+" not found in library");t.meta=o[i]}return t},e.GetChildNodes=function(t,n,o,r,a){void 0===t&&(t=null),void 0===n&&(n=null),void 0===o&&(o=new Array),void 0===r&&(r=new Array),void 0===a&&(a=!0);var i=_.filter(o,function(e){return e.parent_id===t&&(!a||e.container_id===n)});_.forEach(i,function(t){r.push(t.id),e.GetChildNodes(t.id,"",o,r,!1)})},e}();function getSelectValues(e){for(var t,n=[],o=e&&e.options,r=0,a=o.length;r<a;r++)(t=o[r]).selected&&n.push(t.value||t.text);return n}var WvCreateModal$2=function(){function e(){this.isOptionsModalVisible=!1,this.isSaveLoading=!1}return e.prototype.componentWillLoad=function(){this.store.mapStateToProps(this,function(e){return{isOptionsModalVisible:e.isOptionsModalVisible}}),this.store.mapDispatchToProps(this,{setOptionsModalState:setOptionsModalState,updateNodeOptions:updateNodeOptions,addReloadNodeIds:addReloadNodeIds})},e.prototype.cancelOptionsModalHandler=function(e){e.preventDefault(),e.stopPropagation(),this.setOptionsModalState(!1)},e.prototype.saveOptionsModalHandler=function(e){var t=this;t.isSaveLoading=!0,e.preventDefault();var n={},o=document.querySelectorAll("#modal-component-options .modal-body input, #modal-component-options .modal-body textarea, #modal-component-options .modal-body select");o&&o.length>0&&_.forEach(o,function(e){var t=e.name;if(e.type&&"text"!==e.type&&"number"!==e.type&&"email"!==e.type&&"color"!==e.type&&"textarea"!==e.type&&"hidden"!==e.type)if("checkbox"===e.type){var o=!1;if(e.classList.contains("form-check-input")&&(o=!0),!t&&!o)return!0;var r=!1;if(o){r=document.querySelector('#modal-component-options .modal-body input[data-source-id="'+e.id+'"]').value;var a=e.getAttribute("data-field-name");n[a]=r}else e.checked&&(r=!0),n[t]=r}else"select"===e.tagName.toLowerCase()&&(n[t]=e.multiple?getSelectValues(e):e.value);else{if(!t)return!0;switch(e.type){case"number":var i=Number(e.value);isNaN(i)&&(i=null),n[t]=i;break;default:n[t]=e.value}}});var r=NodeUtils.GetActiveNodeAndMeta(t),a=t.store.getState().siteRootUrl+"/api/v3.0/page/"+r.node.page_id+"/node/"+r.node.id+"/options/update",i=t.store.getState().recordId;i&&(a+="?recId="+i),axios$1.post(a,n,{headers:{"Content-Type":"application/json;charset=UTF-8","Access-Control-Allow-Origin":"*"}}).then(function(n){var o=new Event("WvPbManager_Options_Changed"),a=new WvPbEventPayload;a.original_event=e,a.node=r.node,a.component_name=r.node.component_name,o.payload=a,document.dispatchEvent(o);var i=_.findIndex(n.data,function(e){return e.id===r.node.id});i>-1?NodeUtils.GetNodeFromServerToStack(n.data[i],r,t):alert("Error: Node not found in returned results"),t.isSaveLoading=!1,t.setOptionsModalState(!1)}).catch(function(e){t.isSaveLoading=!1,e.response?e.response.data?alert(e.response.data):alert(e.response.statusText):e.message?alert(e.message):alert(e)})},e.prototype.render=function(){var e=this,t=e.isOptionsModalVisible,n=e.store.getState().activeNodeId;if(!t)return null;var o=NodeUtils.GetNodeAndMeta(e,n).node.component_name.split(".");return h("div",{class:"modal show d-block",style:{paddingRight:"17px"},id:"modal-component-options"},h("div",{class:"modal-dialog modal-xl"},h("div",{class:"modal-content"},h("div",{class:"modal-header"},h("span",{class:"title"},h("span",{class:"go-teal"},o[o.length-1])," options"),h("span",{class:"aside"},"wv-",n)),h("div",{class:"modal-body",id:"modal-component-options-body"},h("wv-show-options",{nodeId:n})),h("div",{class:"modal-footer"},h("button",{type:"button",class:"btn btn-primary btn-sm",onClick:function(t){return e.saveOptionsModalHandler(t)},disabled:e.isSaveLoading},h("i",{class:e.isSaveLoading?"fa fa-spin fa-spinner":"fa fa-save"})," Save Options"),h("button",{type:"button",class:"btn btn-white btn-sm",onClick:function(t){return e.cancelOptionsModalHandler(t)}},"Close")))))},Object.defineProperty(e,"is",{get:function(){return"wv-options-modal"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{isOptionsModalVisible:{state:!0},isSaveLoading:{state:!0},store:{context:"store"}}},enumerable:!0,configurable:!0}),e}();function RenderComponentCard(e){var t=e.scope;if(!t.activeNodeId)return h("div",null,"Select a component to review its options");var n=t.store.getState().pageNodes,o=_.findIndex(n,function(e){return e.id===t.activeNodeId});if(-1===o)return null;var r=n[o],a=t.store.getState().library,i=_.findIndex(a,function(e){return e.name===r.component_name});if(-1===i)return null;var s=a[i],d={};return s.color&&(d={color:s.color}),[h("div",{class:"icon-card-body"},h("span",{class:"icon "+s.icon_class,style:d}),h("div",{class:"meta"},h("div",{class:"title"},s.label),h("div",{class:"description"},s.description),h("div",{class:"library"},s.library))),h("hr",{class:"divider",style:{margin:"5px 0"}}),h("div",{class:"row no-gutters"},h("div",{class:"col-6 pr-1"},h("button",{id:"wv-pb-inspector-options-btn",type:"button",class:"btn btn-white btn-sm btn-block",onClick:function(e){return t.showOptionsModalHandler(e)}},h("i",{class:t.isOptionsLoading?"fa fa-spin fa-spinner":"fa fa-cog"})," options")),h("div",{class:"col-6 pl-1"},h("button",{type:"button",class:"btn btn-white btn-sm btn-block",onClick:function(e){return t.showHelpModalHandler(e)}},h("i",{class:t.isHelpLoading?"fa fa-spin fa-spinner":"far fa-question-circle"})," help")))]}function RenderAction(e){var t=e.scope;if(t.activeNodeId)return h("a",{class:"go-red",href:"#",onClick:function(e){window.confirm("Are you sure you wish to delete this component?")&&t.deleteNodeHandler(e)}},h("i",{class:"ti-trash"})," delete node")}function RemoveNode(e){var t=NodeUtils.GetActiveNodeAndMeta(e),n=e.store.getState().siteRootUrl+"/api/v3.0/page/"+t.node.page_id+"/node/"+t.node.id+"/delete",o=e.store.getState().recordId;o&&(n+="?recId="+o),axios$1.post(n,null,{headers:{"Content-Type":"application/json;charset=UTF-8","Access-Control-Allow-Origin":"*"}}).then(function(){var n=new Event("WvPbManager_Node_Removed"),o=new WvPbEventPayload;o.original_event=event,o.node=t.node,o.component_name=t.node.component_name,n.payload=o,document.dispatchEvent(n),e.removeNode(e.activeNodeId)}).catch(function(e){e.response?e.response.data?alert(e.response.data):alert(e.response.statusText):e.message?alert(e.message):alert(e)})}function LoadHelpTemplate(e){e.isHelpLoading=!0;var t=NodeUtils.GetNodeAndMeta(e,e.activeNodeId),n=null;if(t){var o=e.store.getState().siteRootUrl+t.meta.help_view_url+"&nid="+t.node.id+"&pid="+t.node.page_id,r=e.store.getState().recordId;r&&(o+="&recId="+r),axios$1.post(o,t.node.options,{headers:{"Content-Type":"application/json;charset=UTF-8","Access-Control-Allow-Origin":"*"}}).then(function(n){var o=document.getElementById("wv-node-help-stack"),r=document.createElement("div");r.id="node-help-"+e.activeNodeId,r.innerHTML=n.data,o.appendChild(r),runScripts(r);var a=new Event("WvPbManager_Help_Loaded"),i=new WvPbEventPayload;i.node=t.node,i.component_name=t.node.component_name,a.payload=i,document.dispatchEvent(a),e.setHelpModalState(!0),e.isHelpLoading=!1}).catch(function(t){if(n=t.response?t.response.data?t.response.data:t.response.statusText:t.message?t.message:t){var o=document.getElementById("wv-node-"+e.activeNodeId),r=document.createElement("div");r.classList.add("alert"),r.classList.add("alert-danger"),r.classList.add("m-1"),r.classList.add("p-1"),r.innerHTML=n,o.appendChild(r),e.isOptionsLoading=!1}})}}function LoadOptionsTemplate(e){e.isOptionsLoading=!0;var t=NodeUtils.GetNodeAndMeta(e,e.activeNodeId),n=null;if(t){var o=e.store.getState().siteRootUrl+t.meta.options_view_url+"&nid="+t.node.id+"&pid="+t.node.page_id,r=e.store.getState().recordId;r&&(o+="&recId="+r),axios$1.post(o,t.node.options,{headers:{"Content-Type":"application/json;charset=UTF-8","Access-Control-Allow-Origin":"*"}}).then(function(n){var o=document.getElementById("wv-node-options-stack"),r=document.createElement("div");r.id="node-options-"+e.activeNodeId,r.innerHTML=n.data,o.appendChild(r),runScripts(r);var a=new Event("WvPbManager_Options_Loaded"),i=new WvPbEventPayload;i.node=t.node,i.component_name=t.node.component_name,a.payload=i,document.dispatchEvent(a),e.setOptionsModalState(!0),e.isOptionsLoading=!1}).catch(function(t){if(n=t.response?t.response.data?t.response.data:t.response.statusText:t.message?t.message:t){var o=document.getElementById("wv-node-"+e.activeNodeId),r=document.createElement("div");r.classList.add("alert"),r.classList.add("alert-danger"),r.classList.add("m-1"),r.classList.add("p-1"),r.innerHTML=n,o.appendChild(r),e.isOptionsLoading=!1}})}}var root,WvPbInspector=function(){function e(){this.isHelpLoading=!1,this.isOptionsLoading=!1}return e.prototype.componentWillLoad=function(){this.store.mapStateToProps(this,function(e){return{activeNodeId:e.activeNodeId}}),this.store.mapDispatchToProps(this,{removeNode:removeNode,setOptionsModalState:setOptionsModalState,setHelpModalState:setHelpModalState})},e.prototype.deleteNodeHandler=function(e){e.preventDefault(),e.stopPropagation(),RemoveNode(this)},e.prototype.showOptionsModalHandler=function(e){e.preventDefault(),e.stopPropagation(),document.getElementById("node-options-"+this.activeNodeId)?this.setOptionsModalState(!0):LoadOptionsTemplate(this)},e.prototype.showHelpModalHandler=function(e){e.preventDefault(),e.stopPropagation(),document.getElementById("node-help-"+this.activeNodeId)?this.setHelpModalState(!0):LoadHelpTemplate(this)},e.prototype.render=function(){return[h("div",{class:"header"},h("div",{class:"title"},"Inspector"),h("div",{class:"action pr-1"},h(RenderAction,{scope:this}))),h("div",{class:"body"},h(RenderComponentCard,{scope:this}))]},Object.defineProperty(e,"is",{get:function(){return"wv-pb-inspector"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{activeNodeId:{state:!0},isHelpLoading:{state:!0},isOptionsLoading:{state:!0},store:{context:"store"}}},enumerable:!0,configurable:!0}),e}();function symbolObservablePonyfill(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}var result=symbolObservablePonyfill(root="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==global$1?global$1:"undefined"!=typeof module?module:Function("return this")()),randomString=function(){return Math.random().toString(36).substring(7).split("").join(".")},ActionTypes={INIT:"@@redux/INIT"+randomString(),REPLACE:"@@redux/REPLACE"+randomString(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+randomString()}};function isPlainObject(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function createStore(e,t,n){var o;if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function");if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error("Expected the enhancer to be a function.");return n(createStore)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var r=e,a=t,i=[],s=i,d=!1;function c(){s===i&&(s=i.slice())}function l(){if(d)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return a}function u(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(d)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");var t=!0;return c(),s.push(e),function(){if(t){if(d)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");t=!1,c();var n=s.indexOf(e);s.splice(n,1)}}}function p(e){if(!isPlainObject(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(d)throw new Error("Reducers may not dispatch actions.");try{d=!0,a=r(a,e)}finally{d=!1}for(var t=i=s,n=0;n<t.length;n++)(0,t[n])();return e}return p({type:ActionTypes.INIT}),(o={dispatch:p,subscribe:u,getState:l,replaceReducer:function(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");r=e,p({type:ActionTypes.REPLACE})}})[result]=function(){var e,t=u;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function n(){e.next&&e.next(l())}return n(),{unsubscribe:t(n)}}})[result]=function(){return this},e},o}var tick,initialState={},rootReducer=function(e,t){void 0===e&&(e=initialState);var n=Object.assign({},e);switch(t.type){case SET_DRAKE:return n.drake=t.payload,n;case ADD_DRAKE_CONTAINER_ID:var o=document.getElementById(t.payload);return n.drake.containers.push(o),n;case SET_ACTIVE_NODE:return n.activeNodeId=n.activeNodeId&&n.activeNodeId===t.payload?null:t.payload,n;case HOVER_NODE:return n.hoveredNodeId=t.payload,t.payload&&(n.hoveredContainerId=null),n;case HOVER_CONTAINER:return n.hoveredContainerId=t.payload,t.payload&&(n.hoveredNodeId=null),n;case SET_NODE_CREATION:if(t.payload){document.body.className+=" modal-open",document.body.style.paddingRight="17px";var r=document.createElement("div");r.className="modal-backdrop show",r.id="wv-pb-backdrop",document.body.appendChild(r),n.isCreateModalVisible=!0,n.createdNode=t.payload}else document.body.className=document.body.className.replace(" modal-open","").replace("modal-open",""),document.body.style.paddingRight=null,(u=document.getElementById("wv-pb-backdrop"))&&u.parentNode.removeChild(u),n.isCreateModalVisible=!1,n.createdNode=null;return n;case ADD_NODE:n.activeNodeId=t.payload.id;var a=t.payload;return"object"!=typeof a.options&&(a.options=a.options?JSON.parse(a.options):{}),n.pageNodes=n.pageNodes.concat([a]),n.pageNodeChangeIndex++,document.body.className=document.body.className.replace(" modal-open","").replace("modal-open",""),document.body.style.paddingRight=null,(u=document.getElementById("wv-pb-backdrop"))&&u.parentNode.removeChild(u),n.isCreateModalVisible=!1,n.createdNode=null,n;case REMOVE_NODE:return n.pageNodes=_.filter(n.pageNodes,function(e){return e.id.toLowerCase()!==t.payload.toLowerCase()}),n.activeNodeId=null,n.pageNodeChangeIndex++,n;case UPDATE_NODE_OPTIONS:var i=t.payload;if(i){"object"!=typeof i.options&&(i.options=i.options?JSON.parse(i.options):{});var s=_.findIndex(n.pageNodes,function(e){return e.id===i.id});if(s>-1){var d=n.pageNodes[s];d.options=i.options,n.pageNodes=_.filter(n.pageNodes,function(e){return e.id!==i.id}),n.pageNodes.push(d),n.pageNodeChangeIndex++}}return n;case UPDATE_PAGE_NODES:return _.forEach(t.payload,function(e){"object"!=typeof e.options&&(e.options=e.options?JSON.parse(e.options):{}),n.pageNodes=t.payload,n.pageNodeChangeIndex++}),n;case SET_OPTIONS_MODAL_STATE:if(t.payload){document.body.className+=" modal-open",document.body.style.paddingRight="17px";var c=document.createElement("div");c.className="modal-backdrop show",c.id="wv-pb-backdrop",document.body.appendChild(c),n.isOptionsModalVisible=!0}else document.body.className=document.body.className.replace(" modal-open","").replace("modal-open",""),document.body.style.paddingRight=null,(u=document.getElementById("wv-pb-backdrop"))&&u.parentNode.removeChild(u),n.isOptionsModalVisible=!1;return n;case SET_HELP_MODAL_STATE:if(t.payload){document.body.className+=" modal-open",document.body.style.paddingRight="17px";var l=document.createElement("div");l.className="modal-backdrop show",l.id="wv-pb-backdrop",document.body.appendChild(l),n.isHelpModalVisible=!0}else{var u;document.body.className=document.body.className.replace(" modal-open","").replace("modal-open",""),document.body.style.paddingRight=null,(u=document.getElementById("wv-pb-backdrop"))&&u.parentNode.removeChild(u),n.isHelpModalVisible=!1}return n;case ADD_RELOAD_NODE_IDS:return t.payload&&(n.reloadNodeIdList=_.concat(n.reloadNodeIdList,t.payload)),n;case REMOVE_RELOAD_NODE_IDS:return t.payload&&(n.reloadNodeIdList=_.without(n.reloadNodeIdList,t.payload)),n;default:return e}},configureStore=function(e){return createStore(rootReducer,e)},WvPbStore=function(){this.library=new Array,this.pageNodes=new Array,this.pageId=null,this.siteRootUrl=null,this.drake=new Object,this.activeNodeId=null,this.hoveredNodeId=null,this.hoveredContainerId=null,this.pageNodeChangeIndex=1,this.isCreateModalVisible=!1,this.createdNode=new Object,this.isOptionsModalVisible=!1,this.isHelpModalVisible=!1,this.reloadNodeIdList=new Array,this.componentMeta=new Object,this.recordId=null},atoa=function(e,t){return Array.prototype.slice.call(e,t)},si="function"==typeof setImmediate,tickyBrowser=tick=si?function(e){setImmediate(e)}:function(e){setTimeout(e,0)},debounce=function(e,t,n){e&&tickyBrowser(function(){e.apply(n||null,t||[])})},emitter=function(e,t){var n=t||{},o={};return void 0===e&&(e={}),e.on=function(t,n){return o[t]?o[t].push(n):o[t]=[n],e},e.once=function(t,n){return n._once=!0,e.on(t,n),e},e.off=function(t,n){var r=arguments.length;if(1===r)delete o[t];else if(0===r)o={};else{var a=o[t];if(!a)return e;a.splice(a.indexOf(n),1)}return e},e.emit=function(){var t=atoa(arguments);return e.emitterSnapshot(t.shift()).apply(this,t)},e.emitterSnapshot=function(t){var r=(o[t]||[]).slice(0);return function(){var o=atoa(arguments),a=this||e;if("error"===t&&!1!==n.throws&&!r.length)throw 1===o.length?o[0]:o;return r.forEach(function(r){n.async?debounce(r,o,a):r.apply(a,o),r._once&&e.off(t,r)}),e}},e},NativeCustomEvent=commonjsGlobal.CustomEvent;function useNative(){try{var e=new NativeCustomEvent("cat",{detail:{foo:"bar"}});return"cat"===e.type&&"bar"===e.detail.foo}catch(e){}return!1}var customEvent=useNative()?NativeCustomEvent:"function"==typeof document.createEvent?function(e,t){var n=document.createEvent("CustomEvent");return t?n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail):n.initCustomEvent(e,!1,!1,void 0),n}:function(e,t){var n=document.createEventObject();return n.type=e,t?(n.bubbles=Boolean(t.bubbles),n.cancelable=Boolean(t.cancelable),n.detail=t.detail):(n.bubbles=!1,n.cancelable=!1,n.detail=void 0),n},eventmap=[],eventname="",ron=/^on/;for(eventname in commonjsGlobal)ron.test(eventname)&&eventmap.push(eventname.slice(2));var eventmap_1=eventmap,doc=commonjsGlobal.document,addEvent=addEventEasy,removeEvent=removeEventEasy,hardCache=[];commonjsGlobal.addEventListener||(addEvent=addEventHard,removeEvent=removeEventHard);var crossvent={add:addEvent,remove:removeEvent,fabricate:fabricateEvent};function addEventEasy(e,t,n,o){return e.addEventListener(t,n,o)}function addEventHard(e,t,n){return e.attachEvent("on"+t,wrap(e,t,n))}function removeEventEasy(e,t,n,o){return e.removeEventListener(t,n,o)}function removeEventHard(e,t,n){var o=unwrap(e,t,n);if(o)return e.detachEvent("on"+t,o)}function fabricateEvent(e,t,n){var o=-1===eventmap_1.indexOf(t)?new customEvent(t,{detail:n}):function(){var e;return doc.createEvent?(e=doc.createEvent("Event")).initEvent(t,!0,!0):doc.createEventObject&&(e=doc.createEventObject()),e}();e.dispatchEvent?e.dispatchEvent(o):e.fireEvent("on"+t,o)}function wrapperFactory(e,t,n){return function(t){var o=t||commonjsGlobal.event;o.target=o.target||o.srcElement,o.preventDefault=o.preventDefault||function(){o.returnValue=!1},o.stopPropagation=o.stopPropagation||function(){o.cancelBubble=!0},o.which=o.which||o.keyCode,n.call(e,o)}}function wrap(e,t,n){var o=unwrap(e,t,n)||wrapperFactory(e,t,n);return hardCache.push({wrapper:o,element:e,type:t,fn:n}),o}function unwrap(e,t,n){var o=find(e,t,n);if(o){var r=hardCache[o].wrapper;return hardCache.splice(o,1),r}}function find(e,t,n){var o,r;for(o=0;o<hardCache.length;o++)if((r=hardCache[o]).element===e&&r.type===t&&r.fn===n)return o}var cache={},start="(?:^|\\s)",end="(?:\\s|$)";function lookupClass(e){var t=cache[e];return t?t.lastIndex=0:cache[e]=t=new RegExp(start+e+end,"g"),t}function addClass(e,t){var n=e.className;n.length?lookupClass(t).test(n)||(e.className+=" "+t):e.className=t}function rmClass(e,t){e.className=e.className.replace(lookupClass(t)," ").trim()}var classes={add:addClass,rm:rmClass},doc$1=document,documentElement=doc$1.documentElement;function dragula(e,t){var n,o,r,a,i,s,d,c,l,u,p;1===arguments.length&&!1===Array.isArray(e)&&(t=e,e=[]);var f,h=null,m=t||{};void 0===m.moves&&(m.moves=always),void 0===m.accepts&&(m.accepts=always),void 0===m.invalid&&(m.invalid=function(){return!1}),void 0===m.containers&&(m.containers=e||[]),void 0===m.isContainer&&(m.isContainer=never),void 0===m.copy&&(m.copy=!1),void 0===m.copySortSource&&(m.copySortSource=!1),void 0===m.revertOnSpill&&(m.revertOnSpill=!1),void 0===m.removeOnSpill&&(m.removeOnSpill=!1),void 0===m.direction&&(m.direction="vertical"),void 0===m.ignoreInputTextSelection&&(m.ignoreInputTextSelection=!0),void 0===m.mirrorContainer&&(m.mirrorContainer=doc$1.body),void 0===m.slideFactorY&&(m.slideFactorY=5),void 0===m.slideFactorX&&(m.slideFactorX=5);var v=emitter({containers:m.containers,start:function(e){var t=S(e);t&&I(t)},end:_,cancel:P,remove:A,destroy:function(){b(!0),x({})},canMove:function(e){return!!S(e)},dragging:!1});return!0===m.removeOnSpill&&v.on("over",function(e){classes.rm(e,"gu-hide")}).on("out",function(e){v.dragging&&classes.add(e,"gu-hide")}),b(),v;function g(e){return-1!==v.containers.indexOf(e)||m.isContainer(e)}function b(e){var t=e?"remove":"add";touchy(documentElement,t,"mousedown",E),touchy(documentElement,t,"mouseup",x)}function y(e){touchy(documentElement,e?"remove":"add","mousemove",C)}function w(e){var t=e?"remove":"add";crossvent[t](documentElement,"selectstart",N),crossvent[t](documentElement,"click",N)}function N(e){f&&e.preventDefault()}function E(e){if(s=e.clientX,d=e.clientY,1===whichMouseButton(e)&&!e.metaKey&&!e.ctrlKey){var t=e.target,n=S(t);n&&(f=n,y(),"mousedown"===e.type&&(isInput(t)?t.focus():e.preventDefault()))}}function C(e){if(f)if(0!==whichMouseButton(e))if(void 0!==e.clientX&&Math.abs(e.clientX-s)<=(m.slideFactorX||0)&&void 0!==e.clientY&&Math.abs(e.clientY-d)<=(m.slideFactorY||0))console.log("boz");else{if(m.ignoreInputTextSelection){var t=getCoord("clientX",e),o=getCoord("clientY",e);if(isInput(doc$1.elementFromPoint(t,o)))return}var c=f;y(!0),w(),_(),I(c);var l=getOffset(r);a=getCoord("pageX",e)-l.left,i=getCoord("pageY",e)-l.top,classes.add(u||r,"gu-transit"),function(){if(!n){var e=r.getBoundingClientRect();(n=r.cloneNode(!0)).style.width=getRectWidth(e)+"px",n.style.height=getRectHeight(e)+"px",classes.rm(n,"gu-transit"),classes.add(n,"gu-mirror"),m.mirrorContainer.appendChild(n),touchy(documentElement,"add","mousemove",k),classes.add(m.mirrorContainer,"gu-unselectable"),v.emit("cloned",n,r,"mirror")}}(),k(e)}else x({})}function S(e){if(!(v.dragging&&n||g(e))){for(var t=e;getParent(e)&&!1===g(getParent(e));){if(m.invalid(e,t))return;if(!(e=getParent(e)))return}var o=getParent(e);if(o&&!m.invalid(e,t)&&m.moves(e,o,t,nextEl(e)))return{item:e,source:o}}}function I(e){("boolean"==typeof m.copy?m.copy:m.copy(e.item,e.source))&&(u=e.item.cloneNode(!0),v.emit("cloned",u,e.item,"copy")),o=e.source,r=e.item,c=l=nextEl(e.item),v.dragging=!0,v.emit("drag",r,o)}function _(){if(v.dragging){var e=u||r;O(e,getParent(e))}}function T(){f=!1,y(!0),w(!0)}function x(e){if(T(),v.dragging){var t=u||r,a=getCoord("clientX",e),i=getCoord("clientY",e),s=R(getElementBehindPoint(n,a,i),a,i);s&&(u&&m.copySortSource||!u||s!==o)?O(t,s):m.removeOnSpill?A():P()}}function O(e,t){var n=getParent(e);u&&m.copySortSource&&t===o&&n.removeChild(r),M(t)?v.emit("cancel",e,o,o):v.emit("drop",e,t,o,l),L()}function A(){if(v.dragging){var e=u||r,t=getParent(e);t&&t.removeChild(e),v.emit(u?"cancel":"remove",e,t,o),L()}}function P(e){if(v.dragging){var t=arguments.length>0?e:m.revertOnSpill,n=u||r,a=getParent(n),i=M(a);!1===i&&t&&(u?a&&a.removeChild(u):o.insertBefore(n,c)),i||t?v.emit("cancel",n,o,o):v.emit("drop",n,a,o,l),L()}}function L(){var e=u||r;T(),n&&(classes.rm(m.mirrorContainer,"gu-unselectable"),touchy(documentElement,"remove","mousemove",k),getParent(n).removeChild(n),n=null),e&&classes.rm(e,"gu-transit"),p&&clearTimeout(p),v.dragging=!1,h&&v.emit("out",e,h,o),v.emit("dragend",e),o=r=u=c=l=p=h=null}function M(e,t){var a;return a=void 0!==t?t:n?l:nextEl(u||r),e===o&&a===c}function R(e,t,n){for(var a=e;a&&!i();)a=getParent(a);return a;function i(){if(!1===g(a))return!1;var i=D(a,e),s=j(a,i,t,n);return!!M(a,s)||m.accepts(r,a,o,s)}}function k(e){if(n){e.preventDefault();var t=getCoord("clientX",e),s=getCoord("clientY",e),d=s-i;n.style.left=t-a+"px",n.style.top=d+"px";var p=u||r,f=getElementBehindPoint(n,t,s),g=R(f,t,s),b=null!==g&&g!==h;(b||null===g)&&(h&&E("out"),h=g,b&&E("over"));var y=getParent(p);if(g!==o||!u||m.copySortSource){var w,N=D(g,f);if(null!==N)w=j(g,N,t,s);else{if(!0!==m.revertOnSpill||u)return void(u&&y&&y.removeChild(p));w=c,g=o}(null===w&&b||w!==p&&w!==nextEl(p))&&(l=w,g.insertBefore(p,w),v.emit("shadow",p,g,o))}else y&&y.removeChild(p)}function E(e){v.emit(e,p,h,o)}}function D(e,t){for(var n=t;n!==e&&getParent(n)!==e;)n=getParent(n);return n===documentElement?null:n}function j(e,t,n,o){var r,a="horizontal"===m.direction;return t!==e?(r=t.getBoundingClientRect(),i(a?n>r.left+getRectWidth(r)/2:o>r.top+getRectHeight(r)/2)):function(){var t,r,i,s=e.children.length;for(t=0;t<s;t++){if(i=(r=e.children[t]).getBoundingClientRect(),a&&i.left+i.width/2>n)return r;if(!a&&i.top+i.height/2>o)return r}return null}();function i(e){return e?nextEl(t):t}}}function touchy(e,t,n,o){commonjsGlobal.navigator.pointerEnabled?crossvent[t](e,{mouseup:"pointerup",mousedown:"pointerdown",mousemove:"pointermove"}[n],o):commonjsGlobal.navigator.msPointerEnabled?crossvent[t](e,{mouseup:"MSPointerUp",mousedown:"MSPointerDown",mousemove:"MSPointerMove"}[n],o):(crossvent[t](e,{mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove"}[n],o),crossvent[t](e,n,o))}function whichMouseButton(e){if(void 0!==e.touches)return e.touches.length;if(void 0!==e.which&&0!==e.which)return e.which;if(void 0!==e.buttons)return e.buttons;var t=e.button;return void 0!==t?1&t?1:2&t?3:4&t?2:0:void 0}function getOffset(e){var t=e.getBoundingClientRect();return{left:t.left+getScroll("scrollLeft","pageXOffset"),top:t.top+getScroll("scrollTop","pageYOffset")}}function getScroll(e,t){return void 0!==commonjsGlobal[t]?commonjsGlobal[t]:documentElement.clientHeight?documentElement[e]:doc$1.body[e]}function getElementBehindPoint(e,t,n){var o,r=e||{},a=r.className;return r.className+=" gu-hide",o=doc$1.elementFromPoint(t,n),r.className=a,o}function never(){return!1}function always(){return!0}function getRectWidth(e){return e.width||e.right-e.left}function getRectHeight(e){return e.height||e.bottom-e.top}function getParent(e){return e.parentNode===doc$1?null:e.parentNode}function isInput(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName||"SELECT"===e.tagName||isEditable(e)}function isEditable(e){return!!e&&"false"!==e.contentEditable&&("true"===e.contentEditable||isEditable(getParent(e)))}function nextEl(e){return e.nextElementSibling||function(){var t=e;do{t=t.nextSibling}while(t&&1!==t.nodeType);return t}()}function getEventHost(e){return e.targetTouches&&e.targetTouches.length?e.targetTouches[0]:e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e}function getCoord(e,t){var n=getEventHost(t),o={pageX:"clientX",pageY:"clientY"};return e in o&&!(e in n)&&o[e]in n&&(e=o[e]),n[e]}var dragula_1=dragula;function ProcessDropEvent(e,t,n,o){var r=e.store.getState().siteRootUrl+"/api/v3.0/page/"+n+"/node/"+o+"/move",a=e.store.getState().recordId;a&&(r+="?recId="+a),axios$1.post(r,t,{headers:{"Content-Type":"application/json;charset=UTF-8","Access-Control-Allow-Origin":"*"}}).then(function(t){e.updatePageNodes(t.data),window.setTimeout(function(){e.addReloadNodeIds(e.nodesPendingReload),e.nodesPendingReload=new Array,window.setTimeout(function(){_.forEach(e.nodesPendingReload,function(t){var n=NodeUtils.GetNodeAndMeta(e,t),o=new Event("WvPbManager_Node_Moved"),r=new WvPbEventPayload;r.original_event=event,r.node=n.node,r.component_name=n.node.component_name,o.payload=r,document.dispatchEvent(o)});var t=NodeUtils.GetNodeAndMeta(e,o),n=new Event("WvPbManager_Node_Moved"),r=new WvPbEventPayload;r.original_event=event,r.node=t.node,r.component_name=t.node.component_name,n.payload=r,document.dispatchEvent(n);var a=document.querySelectorAll(".wv-container");_.forEach(a,function(e){e.removeAttribute("style")})},10)},10)}).catch(function(e){console.log(e),alert("An error occurred during the move"),location.reload(!0)})}function MoveAffectedNodesToStack(e,t){var n=new Array,o=e.store.getState().pageNodes;NodeUtils.GetChildNodes(t.originParentNodeId,t.originContainerId,o,n),NodeUtils.GetChildNodes(t.newParentNodeId,t.newContainerId,o,n),_.forEach(n,function(e){NodeUtils.MoveNodeToStack(e)}),e.nodesPendingReload=n}function ShowTooltop(e){for(var t=document.querySelectorAll(".wv-pb-content .actions"),n=t.length;n--;){var o=t[n];o.style.left=e.pageX+15+"px",o.style.top=e.pageY+25+"px"}}function RemoveNode$1(e){var t=NodeUtils.GetActiveNodeAndMeta(e),n=e.store.getState().siteRootUrl+"/api/v3.0/page/"+t.node.page_id+"/node/"+t.node.id+"/delete",o=e.store.getState().recordId;o&&(n+="?recId="+o),axios$1.post(n,null,{headers:{"Content-Type":"application/json;charset=UTF-8","Access-Control-Allow-Origin":"*"}}).then(function(){var n=new Event("WvPbManager_Node_Removed"),o=new WvPbEventPayload;o.original_event=event,o.node=t.node,o.component_name=t.node.component_name,n.payload=o,document.dispatchEvent(n),e.removeNode(e.store.getState().activeNodeId)}).catch(function(e){e.response?alert(e.response.statusText+":"+e.response.data):e.message?alert(e.message):alert(e)})}var WvPageManager=function(){function e(){this.libraryJson="[]",this.pageNodesJson="",this.nodesPendingReload=new Array,this.pageNodes=new Array}return e.prototype.componentWillLoad=function(){var e=JSON.parse(this.libraryJson),t=new Array;this.pageNodesJson&&(t=JSON.parse(this.pageNodesJson)),_.forEach(t,function(e){"object"!=typeof e.options&&(e.options=e.options?JSON.parse(e.options):{})});var n=new WvPbStore;n.library=e,n.pageNodes=t,n.siteRootUrl=this.siteRootUrl,n.pageId=this.pageId,n.recordId=this.recordId,_.forEach(e,function(e){n.componentMeta[e.name]=e}),this.store.setStore(configureStore(n)),this.store.mapStateToProps(this,function(e){return{pageNodes:e.pageNodes}}),this.store.mapDispatchToProps(this,{setDrake:setDrake,addReloadNodeIds:addReloadNodeIds,updatePageNodes:updatePageNodes,removeNode:removeNode});var o=this,r=dragula_1({revertOnSpill:!0,direction:"vertical"});r.on("drop",function(e,t,n){var r=0;_.forEach(e.parentElement.childNodes,function(t){if(t===e)return!1;r++});var a={originContainerId:n.getAttribute("data-container-id"),originParentNodeId:n.getAttribute("data-parent-id"),newContainerId:t.getAttribute("data-container-id"),newParentNodeId:t.getAttribute("data-parent-id"),newIndex:r},i=e.getAttribute("data-page-id"),s=e.getAttribute("data-node-id");MoveAffectedNodesToStack(o,a),ProcessDropEvent(o,a,i,s)}),r.on("drag",function(){var e=document.querySelectorAll(".wv-container");_.forEach(e,function(e){e.setAttribute("style","width:"+e.offsetWidth+"px")})}),o.setDrake(r)},e.prototype.handleMouseMove=function(e){ShowTooltop(e)},e.prototype.componentDidLoad=function(){var e=this;document.addEventListener("keydown",function(t){switch(t.key){case"Escape":var n=e.store.getState().drake;n.dragging&&n.cancel();break;case"Delete":var o=e.store.getState().activeNodeId,r=e.store.getState().isOptionsModalVisible,a=e.store.getState().isHelpModalVisible,i=e.store.getState().isCreateModalVisible;!o||r||a||i||window.confirm("Are you sure you wish to delete the selected component?")&&RemoveNode$1(e)}},!1)},e.prototype.render=function(){var e=this,t=[],n=this.store.getState().library;return h("div",{id:"wv-page-manager-wrapper"},h("div",{class:"row no-gutters"},h("div",{class:"col"},h("div",{class:"wv-pb-content"},h("div",{class:"wb-pb-content-inner"},h("wv-pb-node-container",{"parent-node-id":null,containerId:""})))),h("div",{class:"col-auto",style:{width:"400px"}},h("wv-pb-inspector",null),h("wv-pb-tree",null))),this.pageNodes.map(function(o){var r=o.component_name;if(-1===_.findIndex(t,function(e){return e===r})){var a=_.findIndex(n,function(e){return e.name==r});if(a>-1)return n[a].service_js_url?(t.push(r),h("script",{key:o.id,src:e.siteRootUrl+n[a].service_js_url})):(console.info("Service not found for "+r),null)}return null}),h("div",{id:"wv-node-design-stack",class:"d-none"}),h("div",{id:"wv-node-options-stack",class:"d-none"}),h("div",{id:"wv-node-help-stack",class:"d-none"}),h("wv-create-modal",null),h("wv-help-modal",null),h("wv-options-modal",null))},Object.defineProperty(e,"is",{get:function(){return"wv-pb-manager"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{libraryJson:{type:String,attr:"library-json"},nodesPendingReload:{state:!0},pageId:{type:String,attr:"page-id"},pageNodes:{state:!0},pageNodesJson:{type:String,attr:"page-nodes-json"},recordId:{type:String,attr:"record-id"},siteRootUrl:{type:String,attr:"site-root-url"},store:{context:"store"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"listeners",{get:function(){return[{name:"mousemove",method:"handleMouseMove",passive:!0}]},enumerable:!0,configurable:!0}),e}();function LoadTemplate(e){var t=NodeUtils.GetNodeAndMeta(e,e.nodeId),n=null;if(t){var o=e.store.getState().siteRootUrl+t.meta.design_view_url+"&nid="+t.node.id+"&pid="+t.node.page_id,r=e.store.getState().recordId;r&&(o+="&recId="+r);var a=t.node.options;e.isLoading=!0,axios$1.post(o,a,{headers:{"Content-Type":"application/json;charset=UTF-8","Access-Control-Allow-Origin":"*"}}).then(function(n){e.isLoading=!1;var o=document.getElementById("wv-node-"+e.nodeId),r=document.createElement("div");r.id="node-design-"+e.nodeId,r.classList.add("wv-pb-node"),r.innerHTML=n.data,o.appendChild(r),runScripts(r);var a=new Event("WvPbManager_Design_Loaded"),i=new WvPbEventPayload;i.node=t.node,i.component_name=t.node.component_name,a.payload=i,document.dispatchEvent(a)}).catch(function(t){if(n=t.response?t.response.data?t.response.data:t.response.statusText:t.message?t.message:t){var o=document.getElementById("wv-node-"+e.nodeId),r=document.createElement("div");r.classList.add("alert"),r.classList.add("alert-danger"),r.classList.add("m-1"),r.classList.add("p-1"),r.innerHTML=n,o.appendChild(r),e.isLoading=!1}})}}var WvNode=function(){function e(){this.isLoading=!1}return e.prototype.componentWillLoad=function(){this.nodeId&&(this.store.mapStateToProps(this,function(e){return{reloadNodeIdList:e.reloadNodeIdList}}),this.store.mapDispatchToProps(this,{removeReloadNodeIds:removeReloadNodeIds}))},e.prototype.nodeIndexUpdateHandler=function(e){var t=this;_.findIndex(e,function(e){return e===t.nodeId})>-1&&(t.el.parentElement.classList.contains("gu-mirror")||(NodeUtils.GetNodeFromStack(t.nodeId)||LoadTemplate(t),t&&"function"==typeof t.removeReloadNodeIds&&t.removeReloadNodeIds(t.nodeId)))},e.prototype.render=function(){return this.el.parentElement.classList.contains("gu-mirror")?null:this.isLoading?h("wv-loading-pane",null):null},Object.defineProperty(e,"is",{get:function(){return"wv-pb-node"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{el:{elementRef:!0},isLoading:{state:!0},nodeId:{type:String,attr:"node-id"},reloadNodeIdList:{state:!0,watchCallbacks:["nodeIndexUpdateHandler"]},store:{context:"store"}}},enumerable:!0,configurable:!0}),e}(),guid=function(){function e(){}return e.newGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},e}();function GetContainerNodes(e,t,n){var o=new Array;return _.forEach(n,function(n){e||n.parent_id?e&&n.parent_id&&e.toLowerCase()===n.parent_id.toLowerCase()&&(t||n.container_id?t&&n.container_id&&t.toLowerCase()===n.container_id.toLowerCase()&&o.push(n):o.push(n)):t||n.container_id?t&&n.container_id&&t.toLowerCase()===n.container_id.toLowerCase()&&o.push(n):o.push(n)}),_.sortBy(o,["weight"])}var WvContainer=function(){function e(){this.containerId=null,this.parentNodeId=null}return e.prototype.componentWillLoad=function(){this.store.mapStateToProps(this,function(e){return{activeNodeId:e.activeNodeId,hoveredNodeId:e.hoveredNodeId,hoveredContainerId:e.hoveredContainerId,pageNodeChangeIndex:e.pageNodeChangeIndex}}),this.store.mapDispatchToProps(this,{addDrakeContainerId:addDrakeContainerId,hoverContainer:hoverContainer,hoverNode:hoverNode,setActiveNode:setActiveNode,setNodeCreation:setNodeCreation,addReloadNodeIds:addReloadNodeIds})},e.prototype.componentDidLoad=function(){this.addDrakeContainerId("wv-container-"+this.parentNodeId+"-"+this.containerId);var e=GetContainerNodes(this.parentNodeId,this.containerId,this.store.getState().pageNodes),t=new Array;_.forEach(e,function(e){t.push(e.id)}),this.addReloadNodeIds(t)},e.prototype.pageNodeIndexChangeHandler=function(){var e="wv-container-"+this.parentNodeId+"-"+this.containerId,t=document.getElementById(e);if(t){var n=this.store.getState().drake;-1==_.findIndex(n.containers,function(t){return t.id===e})&&n.containers.push(t)}},e.prototype.hoverContainerHandler=function(e){e.preventDefault(),e.stopPropagation(),this.hoverContainer("wv-container-"+this.parentNodeId+"-"+this.containerId)},e.prototype.unhoverContainerHandler=function(e){e.preventDefault(),e.stopPropagation();var t=e.target.parentNode.closest(".wv-pb-node.hovarable");if(t){var n=t.attributes["data-node-id"];n&&this.hoverNode(n.value)}else this.hoverContainer(null)},e.prototype.nodeClickHandler=function(e,t){e.preventDefault(),e.stopPropagation(),this.setActiveNode(t)},e.prototype.hoverNodeHandler=function(e){e.preventDefault(),e.stopPropagation();var t=e.target.getAttribute("data-node-id");this.hoverNode(t)},e.prototype.unhoverNodeHandler=function(e){e.preventDefault(),e.stopPropagation();var t=e.target.parentNode.closest(".wv-container-inner.hovarable");if(t){var n=t.attributes["data-container-id"];n&&this.hoverContainer(n.value)}else this.hoverNode(null)},e.prototype.addNodeHandler=function(e){e.preventDefault(),e.stopPropagation();var t=0,n=GetContainerNodes(this.parentNodeId,this.containerId,this.store.getState().pageNodes);_.forEach(n,function(e){e.weight>t&&(t=e.weight)});var o={id:guid.newGuid(),container_id:this.containerId,parent_id:this.parentNodeId,weight:t+1,page_id:this.store.getState().pageId,component_name:null,node_id:null,options:{},nodes:[]};this.setNodeCreation(o)},e.prototype.render=function(){var e=this,t=this,n=GetContainerNodes(t.parentNodeId,t.containerId,t.store.getState().pageNodes),o="wv-container-"+t.parentNodeId+"-"+t.containerId,r="";t.containerId||(r+=" first"),t.hoveredContainerId==o&&(r+=" hovered"),0===n.length&&(r+=" empty");var a=t.store.getState().componentMeta;return h("div",{class:"wv-container-inner hovarable "+r,onClick:function(t){return e.addNodeHandler(t)},onMouseEnter:function(e){return t.hoverContainerHandler(e)},onMouseLeave:function(e){return t.unhoverContainerHandler(e)},"data-container-id":o},h("div",{class:"actions"},h("i",{class:"fa fa-plus go-green"})," add in ",t.containerId),h("div",{class:"wv-container",id:o,"data-parent-id":t.parentNodeId,"data-container-id":t.containerId},n.map(function(e){var n="";return t.activeNodeId&&e.id===t.activeNodeId&&(n+=" selected"),t.hoveredNodeId&&e.id===t.hoveredNodeId&&!t.hoveredContainerId&&(n+=" hovered"),a[e.component_name].is_inline&&(n+=" d-inline-block"),h("div",{key:e.id,id:"wv-node-"+e.id,class:"wv-node-wrapper draggable-node hovarable "+n,"data-node-id":e.id,"data-page-id":e.page_id,onClick:function(n){return t.nodeClickHandler(n,e.id)},onMouseEnter:function(e){return t.hoverNodeHandler(e)},onMouseLeave:function(e){return t.unhoverNodeHandler(e)}},h("div",{class:"actions"},h("i",{class:"fa fa-search go-blue"})," select ",a[e.component_name].label),h("wv-pb-node",{nodeId:e.id}))})))},Object.defineProperty(e,"is",{get:function(){return"wv-pb-node-container"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{activeNodeId:{state:!0},containerId:{type:String,attr:"container-id"},hoveredContainerId:{state:!0},hoveredNodeId:{state:!0},pageNodeChangeIndex:{state:!0,watchCallbacks:["pageNodeIndexChangeHandler"]},parentNodeId:{type:String,attr:"parent-node-id"},store:{context:"store"}}},enumerable:!0,configurable:!0}),e}(),WvCreateModal$3=function(){function e(){this.nodeId="",this.isHelpModalVisible=!1}return e.prototype.componentWillLoad=function(){this.store.mapStateToProps(this,function(e){return{isHelpModalVisible:e.isHelpModalVisible}});var e=document.getElementById("node-help-"+this.nodeId),t=document.getElementById("modal-component-help-body");e&&t.appendChild(e)},e.prototype.helpModalVisibilityHandler=function(e,t){if(!e&&t){var n=document.getElementById("wv-node-help-stack"),o=document.getElementById("node-help-"+this.nodeId);o&&n.appendChild(o)}},e.prototype.render=function(){return null},Object.defineProperty(e,"is",{get:function(){return"wv-show-help"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{isHelpModalVisible:{state:!0,watchCallbacks:["helpModalVisibilityHandler"]},nodeId:{type:String,attr:"node-id"},store:{context:"store"}}},enumerable:!0,configurable:!0}),e}(),WvCreateModal$4=function(){function e(){this.nodeId="",this.isOptionsModalVisible=!1}return e.prototype.componentWillLoad=function(){this.store.mapStateToProps(this,function(e){return{isOptionsModalVisible:e.isOptionsModalVisible}});var e=document.getElementById("node-options-"+this.nodeId),t=document.getElementById("modal-component-options-body");e&&t.appendChild(e)},e.prototype.optionsModalVisibilityHandler=function(e,t){if(!e&&t){var n=document.getElementById("wv-node-options-stack"),o=document.getElementById("node-options-"+this.nodeId);o&&n.appendChild(o)}},e.prototype.render=function(){return null},Object.defineProperty(e,"is",{get:function(){return"wv-show-options"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{isOptionsModalVisible:{state:!0,watchCallbacks:["optionsModalVisibilityHandler"]},nodeId:{type:String,attr:"node-id"},store:{context:"store"}}},enumerable:!0,configurable:!0}),e}();export{WvCreateModal,WvCreateModal$1 as WvHelpModal,WvLoadingPane,WvCreateModal$2 as WvOptionsModal,WvPbInspector,WvPageManager as WvPbManager,WvNode as WvPbNode,WvContainer as WvPbNodeContainer,WvCreateModal$3 as WvShowHelp,WvCreateModal$4 as WvShowOptions};